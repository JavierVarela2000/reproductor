var g=Object.defineProperty;var f=r=>{throw TypeError(r)};var k=(r,t,e)=>t in r?g(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var y=(r,t,e)=>k(r,typeof t!="symbol"?t+"":t,e),x=(r,t,e)=>t.has(r)||f("Cannot "+e);var s=(r,t,e)=>(x(r,t,"read from private field"),e?e.call(r):t.get(r)),a=(r,t,e)=>t.has(r)?f("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e);import{s as n,g as l,a as u,p as m}from"./BKrh2xdt.js";var c,h,d,p,_;class I{constructor(t=null){a(this,c,n(null));a(this,h,n(null));a(this,d,n(m({is_playing:!1,is_paused:!1,is_buffering:!1,is_seeking:!1,is_ended:!1})));y(this,"audio_player");a(this,p,n(null));a(this,_,n(!0));y(this,"handleProgress",()=>{const t=this.audio_player.buffered,e=this.audio_player.duration;if(t.length>0&&e>0){const o=t.end(t.length-1)/e*100;o>=5&&!this.state.is_playing&&this.play(),o<100?this.current_buffered=o:(this.state={...this.state,is_buffering:!1},this.audio_player.removeEventListener("progress",this.handleProgress))}});t?this.audio_player=t:(this.audio_player=new Audio,this.audio_player.volume=.5),this.initializeAudioPlayer()}get current_playlist(){return l(s(this,c))}set current_playlist(t){u(s(this,c),t,!0)}get current_track(){return l(s(this,h))}set current_track(t){u(s(this,h),t,!0)}get state(){return l(s(this,d))}set state(t){u(s(this,d),t,!0)}get current_time(){return l(s(this,p))}set current_time(t){u(s(this,p),t,!0)}get is_autoplay(){return l(s(this,_))}set is_autoplay(t){u(s(this,_),t,!0)}initializeAudioPlayer(){this.audio_player.addEventListener("timeupdate",()=>{this.state.is_seeking||(this.current_time=this.audio_player.currentTime)}),this.audio_player.addEventListener("loadedmetadata",()=>{this.state={is_buffering:!0,is_playing:!1,is_paused:!1,is_seeking:!1,is_ended:!1}}),this.audio_player.addEventListener("progress",this.handleProgress),this.audio_player.addEventListener("ended",()=>{if(!this.is_autoplay||!this.current_playlist)return;const t=this.getTrackIndex(1);this.play_track(this.current_playlist.tracks[t])})}play_track(t){this.current_track=t,this.audio_player.src=t.url,this.audio_player.load(),this.play()}play(){if(!this.current_track){console.error("No hay pista actual para reproducir.");return}this.audio_player.play().then(()=>{this.state={...this.state,is_playing:!0,is_paused:!1,is_seeking:!1}})}pause(){this.audio_player.pause(),this.state={...this.state,is_playing:!1,is_paused:!0}}next(){if(!this.current_playlist){console.error("No hay lista de reproducción actual.");return}if(this.current_playlist.tracks.length===0){console.warn("No hay pistas en la lista de reproducción.");return}const e=(this.current_playlist.tracks.findIndex(i=>i===this.current_track)+1)%this.current_playlist.tracks.length;this.play_track(this.current_playlist.tracks[e])}prev(){if(!this.audio_player){console.error("El reproductor de audio no está disponible.");return}if(!this.current_playlist){console.error("No hay lista de reproducción actual.");return}if(this.current_playlist.tracks.length===0){console.warn("No hay pistas en la lista de reproducción.");return}const e=(this.current_playlist.tracks.findIndex(i=>i===this.current_track)-1+this.current_playlist.tracks.length)%this.current_playlist.tracks.length;this.play_track(this.current_playlist.tracks[e])}seek(t){this.current_time=t,this.audio_player.currentTime=this.current_time}getTrackIndex(t=0){return this.current_playlist?(this.current_playlist.tracks.findIndex(i=>i===this.current_track)+t+this.current_playlist.tracks.length)%this.current_playlist.tracks.length:-1}reset(){this.audio_player.pause(),this.state={is_playing:!1,is_paused:!1,is_buffering:!1,is_seeking:!1,is_ended:!1},this.current_track=null,this.current_playlist=null,this.current_time=0,this.audio_player.src=""}}c=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,_=new WeakMap;const E=new I;export{E as p};
